/Users/stlee/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(
Traceback (most recent call last):
  File "/Users/stlee/Desktop/EPL-Match-Predictor/backend/test_e2e_comprehensive.py", line 187, in run_simulation
    for i, iter_result in enumerate(result['iteration_history'], 1):
KeyError: 'iteration_history'
Traceback (most recent call last):
  File "/Users/stlee/Desktop/EPL-Match-Predictor/backend/simulation/v3/ai_integration.py", line 139, in generate_scenario
    scenario = self._dict_to_scenario(scenario_dict)
  File "/Users/stlee/Desktop/EPL-Match-Predictor/backend/simulation/v3/ai_integration.py", line 529, in _dict_to_scenario
    for e in data['events']:
KeyError: 'events'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/stlee/Desktop/EPL-Match-Predictor/backend/test_e2e_comprehensive.py", line 145, in run_simulation
    result = simulator.simulate_match(match_input)
  File "/Users/stlee/Desktop/EPL-Match-Predictor/backend/simulation/v3/match_simulator_v3.py", line 81, in simulate_match
    scenario = self.ai.generate_scenario(match_input)
  File "/Users/stlee/Desktop/EPL-Match-Predictor/backend/simulation/v3/ai_integration.py", line 141, in generate_scenario
    raise AIClientError(f"Phase 1 Scenario ìƒì„± ì‹¤íŒ¨: {e}")
simulation.v3.ai_integration.AIClientError: Phase 1 Scenario ìƒì„± ì‹¤íŒ¨: 'events'
Traceback (most recent call last):
  File "/Users/stlee/Desktop/EPL-Match-Predictor/backend/test_e2e_comprehensive.py", line 187, in run_simulation
    for i, iter_result in enumerate(result['iteration_history'], 1):
KeyError: 'iteration_history'

======================================================================
ğŸš€ COMPREHENSIVE E2E TEST SUITE
======================================================================

Testing Domain Knowledge â†’ AI Scenario â†’ Simulation Pipeline
All tests use REAL Qwen AI (no mocks)

======================================================================

======================================================================
ğŸ”§ Qwen AI Setup
======================================================================
âœ… Qwen AI is ready!




â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
TEST 1: Strong Team vs Weak Team
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

======================================================================
ğŸ® Test Scenario: Strong vs Weak
======================================================================

ğŸ“‹ Match Setup:
  Home: Manchester City
    - Attack: 92.0, Defense: 88.0
    - Press: 85.0, Style: possession
    - Form: WWWWW, Injuries: 0

  Away: Sheffield United
    - Attack: 55.0, Defense: 58.0
    - Press: 52.0, Style: direct
    - Form: LLLLD, Injuries: 2

  Venue: Etihad Stadium
  Importance: regular

âš¡ Running simulation (max 3 iterations)...
  (This may take 1-2 minutes depending on AI response time...)

============================================================
Match Simulator V3: Manchester City vs Sheffield United
============================================================

Phase 1: AI ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±...
  âœ… ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì™„ë£Œ: 4ê°œ ì´ë²¤íŠ¸

ğŸ“Š Adaptive Threshold: 0.536 (Base: 0.600)
  ì „ë ¥ ì°¨ì´: 33.5 â†’ -0.067
  ìŠ¤íƒ€ì¼ ìœ ì‚¬ë„: 0.00 â†’ +0.000
  Form ë³€ë™ì„±: 0.10 â†’ +0.003

--- Iteration 1/3 ---
Phase 2: Statistical Engine ì‹œë®¬ë ˆì´ì…˜...
  ìµœì¢… ìŠ¤ì½”ì–´: 3-1
  ì„œì‚¬ ì¼ì¹˜ìœ¨: 0%
Phase 3: AI ë¶„ì„/ì¡°ì •...
  AI ìƒíƒœ: needs_adjustment
Phase 4: ìˆ˜ë ´ íŒë‹¨...
  ìˆ˜ë ´ ì ìˆ˜: 0.12
  ìˆ˜ë ´ ì—¬ë¶€: âŒ No
  ğŸ“Œ New best score: 0.12
Phase 5: ì‹œë‚˜ë¦¬ì˜¤ ì¡°ì •...
  âœ… Smoothing ì ìš© ì™„ë£Œ (Î±=0.33)

--- Iteration 2/3 ---
Phase 2: Statistical Engine ì‹œë®¬ë ˆì´ì…˜...
  ìµœì¢… ìŠ¤ì½”ì–´: 4-1
  ì„œì‚¬ ì¼ì¹˜ìœ¨: 17%
Phase 3: AI ë¶„ì„/ì¡°ì •...
  AI ìƒíƒœ: needs_adjustment
Phase 4: ìˆ˜ë ´ íŒë‹¨...
  ìˆ˜ë ´ ì ìˆ˜: 0.31
  ìˆ˜ë ´ ì—¬ë¶€: âŒ No
  ğŸ“Œ New best score: 0.31
Phase 5: ì‹œë‚˜ë¦¬ì˜¤ ì¡°ì •...
  âœ… Smoothing ì ìš© ì™„ë£Œ (Î±=0.36)

--- Iteration 3/3 ---
Phase 2: Statistical Engine ì‹œë®¬ë ˆì´ì…˜...
  ìµœì¢… ìŠ¤ì½”ì–´: 3-3
  ì„œì‚¬ ì¼ì¹˜ìœ¨: 14%
Phase 3: AI ë¶„ì„/ì¡°ì •...
  AI ìƒíƒœ: converged
Phase 4: ìˆ˜ë ´ íŒë‹¨...
  ìˆ˜ë ´ ì ìˆ˜: 0.65
  ìˆ˜ë ´ ì—¬ë¶€: âœ… Yes
  ğŸ“Œ New best score: 0.65

âœ… ìˆ˜ë ´ ì™„ë£Œ! (Iteration 3)

Phase 7: ìµœì¢… ë¦¬í¬íŠ¸ ìƒì„±...
  âœ… ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ (1803 ë¬¸ì)

============================================================
âœ… ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ!
============================================================


======================================================================
ğŸ“Š Simulation Results
======================================================================

âœ… Final Score: 3-3
âœ… Iterations: 3/3
âœ… Convergence Score: 0.65
âœ… Converged: True
âœ… Narrative Adherence: 14%
âœ… Execution Time: 177.1s

ğŸ“ˆ Match Statistics:
  Shots: 21 - 17
  Possession: 35% - 55%
  xG: 0.00 - 0.00

ğŸ¬ AI Scenario Analysis:

ğŸ”„ Convergence Process:

âŒ Simulation failed after 177.1s: 'iteration_history'

âŒ Test 'Strong vs Weak' FAILED



â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
TEST 2: Balanced Top Clash
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

======================================================================
ğŸ® Test Scenario: Balanced Top Clash
======================================================================

ğŸ“‹ Match Setup:
  Home: Arsenal
    - Attack: 85.0, Defense: 82.0
    - Press: 88.0, Style: possession
    - Form: WWDWL, Injuries: 1

  Away: Liverpool
    - Attack: 87.0, Defense: 80.0
    - Press: 85.0, Style: mixed
    - Form: WWLWW, Injuries: 0

  Venue: Emirates Stadium
  Importance: top_clash

âš¡ Running simulation (max 4 iterations)...
  (This may take 1-2 minutes depending on AI response time...)

============================================================
Match Simulator V3: Arsenal vs Liverpool
============================================================

Phase 1: AI ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±...

âŒ Simulation failed after 71.6s: Phase 1 Scenario ìƒì„± ì‹¤íŒ¨: 'events'

âŒ Test 'Balanced Top Clash' FAILED



â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
TEST 3: Possession vs Direct Style
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

======================================================================
ğŸ® Test Scenario: Possession vs Direct
======================================================================

ğŸ“‹ Match Setup:
  Home: Brighton
    - Attack: 75.0, Defense: 72.0
    - Press: 82.0, Style: possession
    - Form: WDWDW, Injuries: 0

  Away: Burnley
    - Attack: 68.0, Defense: 75.0
    - Press: 65.0, Style: direct
    - Form: DWLWD, Injuries: 1

  Venue: Amex Stadium
  Importance: regular

âš¡ Running simulation (max 3 iterations)...
  (This may take 1-2 minutes depending on AI response time...)

============================================================
Match Simulator V3: Brighton vs Burnley
============================================================

Phase 1: AI ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±...
  âœ… ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì™„ë£Œ: 5ê°œ ì´ë²¤íŠ¸

ğŸ“Š Adaptive Threshold: 0.611 (Base: 0.600)
  ì „ë ¥ ì°¨ì´: 2.0 â†’ -0.004
  ìŠ¤íƒ€ì¼ ìœ ì‚¬ë„: 0.00 â†’ +0.000
  Form ë³€ë™ì„±: 0.50 â†’ +0.015

--- Iteration 1/3 ---
Phase 2: Statistical Engine ì‹œë®¬ë ˆì´ì…˜...
  ìµœì¢… ìŠ¤ì½”ì–´: 1-2
  ì„œì‚¬ ì¼ì¹˜ìœ¨: 0%
Phase 3: AI ë¶„ì„/ì¡°ì •...
  AI ìƒíƒœ: needs_adjustment
Phase 4: ìˆ˜ë ´ íŒë‹¨...
  ìˆ˜ë ´ ì ìˆ˜: 0.12
  ìˆ˜ë ´ ì—¬ë¶€: âŒ No
  ğŸ“Œ New best score: 0.12
Phase 5: ì‹œë‚˜ë¦¬ì˜¤ ì¡°ì •...
  âœ… Smoothing ì ìš© ì™„ë£Œ (Î±=0.33)

--- Iteration 2/3 ---
Phase 2: Statistical Engine ì‹œë®¬ë ˆì´ì…˜...
  ìµœì¢… ìŠ¤ì½”ì–´: 1-4
  ì„œì‚¬ ì¼ì¹˜ìœ¨: 0%
Phase 3: AI ë¶„ì„/ì¡°ì •...
  AI ìƒíƒœ: needs_adjustment
Phase 4: ìˆ˜ë ´ íŒë‹¨...
  ìˆ˜ë ´ ì ìˆ˜: 0.15
  ìˆ˜ë ´ ì—¬ë¶€: âœ… Yes
  ğŸ“Œ New best score: 0.15

âœ… ìˆ˜ë ´ ì™„ë£Œ! (Iteration 2)

Phase 7: ìµœì¢… ë¦¬í¬íŠ¸ ìƒì„±...
  âœ… ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ (1543 ë¬¸ì)

============================================================
âœ… ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ!
============================================================


======================================================================
ğŸ“Š Simulation Results
======================================================================

âœ… Final Score: 1-4
âœ… Iterations: 2/3
âœ… Convergence Score: 0.15
âœ… Converged: True
âœ… Narrative Adherence: 0%
âœ… Execution Time: 192.0s

ğŸ“ˆ Match Statistics:
  Shots: 15 - 14
  Possession: 39% - 51%
  xG: 0.00 - 0.00

ğŸ¬ AI Scenario Analysis:

ğŸ”„ Convergence Process:

âŒ Simulation failed after 192.0s: 'iteration_history'

âŒ Test 'Possession vs Direct' FAILED



Traceback (most recent call last):
  File "/Users/stlee/Desktop/EPL-Match-Predictor/backend/test_e2e_comprehensive.py", line 145, in run_simulation
    result = simulator.simulate_match(match_input)
  File "/Users/stlee/Desktop/EPL-Match-Predictor/backend/simulation/v3/match_simulator_v3.py", line 158, in simulate_match
    smoothed_scenario = self.ai.apply_scenario_smoothing(
  File "/Users/stlee/Desktop/EPL-Match-Predictor/backend/simulation/v3/ai_integration.py", line 364, in apply_scenario_smoothing
    return Scenario(
  File "<string>", line 6, in __init__
  File "/Users/stlee/Desktop/EPL-Match-Predictor/backend/ai/data_models.py", line 151, in __post_init__
    assert 3 <= len(self.events) <= 10, \
AssertionError: ì´ë²¤íŠ¸ëŠ” 3-10ê°œì—¬ì•¼ í•¨: 13ê°œ
