# ğŸ§  Deep AI Match Simulation Architecture
**EPL Predictor - Ultra-Realistic Match Simulation Engine**

Version: 4.0 (Deep Reasoning Edition)
Created: 2025-10-09
Status: Advanced Planning

---

## ğŸ¯ Vision: Virtual Match Reality

**Goal**: AIê°€ ì‹¤ì œ 90ë¶„ ê²½ê¸°ë¥¼ ë¶„ë‹¨ìœ„ë¡œ ì‹œë®¬ë ˆì´ì…˜í•˜ë©°, ë§ˆì¹˜ ì‹¤ì œ ê²½ê¸°ë¥¼ ê´€ì „í•˜ë“¯ ìƒì„¸í•œ ì´ë²¤íŠ¸ì™€ ì „ìˆ ì  íŒë‹¨ì„ ì œê³µí•˜ëŠ” ì´ˆì •ë°€ ì‹œë®¬ë ˆì´ì…˜ ì—”ì§„.

### Key Differentiators
- âœ… **ë¶„ë‹¨ìœ„ ê²½ê¸° ì§„í–‰ ì‹œë®¬ë ˆì´ì…˜** (90ë¶„ ì „ì²´)
- âœ… **Chain-of-Thought Deep Reasoning** (Claude í™•ì¥ ì¶”ë¡ )
- âœ… **Multi-Agent AI System** (ê³µê²©/ìˆ˜ë¹„/ì „ìˆ  ë¶„ì„ê°€ í˜‘ì—…)
- âœ… **Monte Carlo Simulation** (1,000íšŒ ë°˜ë³µ ì‹¤í–‰)
- âœ… **ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°** (ê³¨, ìŠˆíŒ…, íŒ¨ìŠ¤, íŒŒìš¸ ë“±)
- âœ… **ì„ ìˆ˜ë³„ Individual Performance Tracking**

---

## ğŸ—ï¸ System Architecture

### **3-Layer Deep Reasoning Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LAYER 1: Data Preparation                     â”‚
â”‚  (0.5~2ì´ˆ)                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   User      â”‚  â”‚  Sharp Vision â”‚  â”‚  Football-Data  â”‚        â”‚
â”‚  â”‚ Evaluation  â”‚  â”‚     API       â”‚  â”‚   API (Form)    â”‚        â”‚
â”‚  â”‚   (65%)     â”‚  â”‚    (20%)      â”‚  â”‚     (15%)       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                 â”‚                    â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                           â”‚                                       â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚  Data Fusion  â”‚                              â”‚
â”‚                    â”‚   & Normalization                            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LAYER 2: Multi-Agent Deep Analysis                   â”‚
â”‚  (15~45ì´ˆ)                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Agent 1: Strategic Analyst (ì „ëµ ë¶„ì„ê°€)                â”‚   â”‚
â”‚  â”‚  Model: Claude Sonnet 4.5 + Extended Thinking            â”‚   â”‚
â”‚  â”‚  Task: ì „ìˆ  ë§¤ì¹˜ì—…, í¬ë©”ì´ì…˜ ë¶„ì„, ì•½ì /ê°•ì  ì‹ë³„        â”‚   â”‚
â”‚  â”‚  Output: Tactical Assessment Report                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Agent 2: Offensive Specialist (ê³µê²© ì „ë¬¸ê°€)             â”‚   â”‚
â”‚  â”‚  Model: Claude Sonnet 4.5 + CoT                           â”‚   â”‚
â”‚  â”‚  Task: ì˜ˆìƒ ê³µê²© íŒ¨í„´, xG ê³„ì‚°, ìŠˆíŒ… ê¸°íšŒ ë¶„ì„            â”‚   â”‚
â”‚  â”‚  Output: Offensive Potential Matrix                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Agent 3: Defensive Specialist (ìˆ˜ë¹„ ì „ë¬¸ê°€)             â”‚   â”‚
â”‚  â”‚  Model: Claude Sonnet 4.5 + CoT                           â”‚   â”‚
â”‚  â”‚  Task: ìˆ˜ë¹„ ë¼ì¸ ì•ˆì •ì„±, ì••ë°• íš¨ìœ¨, ì‹¤ì  ìœ„í—˜ ë¶„ì„        â”‚   â”‚
â”‚  â”‚  Output: Defensive Stability Index                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Agent 4: Player Performance Predictor (ì„ ìˆ˜ í¼í¬ë¨¼ìŠ¤)   â”‚   â”‚
â”‚  â”‚  Model: Claude Sonnet 4.5                                 â”‚   â”‚
â”‚  â”‚  Task: 22ëª… ì„ ìˆ˜ ê°œë³„ ì˜ˆìƒ í¼í¬ë¨¼ìŠ¤ (0~10ì  ìŠ¤ì¼€ì¼)       â”‚   â”‚
â”‚  â”‚  Output: Individual Player Ratings (22 players)           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                    â”‚  Agent Synthesisâ”‚                            â”‚
â”‚                    â”‚  (ì¢…í•© íŒë‹¨)    â”‚                            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           LAYER 3: Monte Carlo Match Simulation                   â”‚
â”‚  (20~60ì´ˆ)                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Minute-by-Minute Match Engine                            â”‚   â”‚
â”‚  â”‚  Model: Claude Sonnet 4.5 (Orchestrator)                  â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚  For each minute (1~90):                                   â”‚   â”‚
â”‚  â”‚    1. Calculate possession probability                     â”‚   â”‚
â”‚  â”‚    2. Determine event type (pass/shot/tackle/foul)        â”‚   â”‚
â”‚  â”‚    3. Evaluate player involvement                          â”‚   â”‚
â”‚  â”‚    4. Calculate scoring chance (if shot)                   â”‚   â”‚
â”‚  â”‚    5. Update game state                                    â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚  Run 1,000 simulations in parallel                         â”‚   â”‚
â”‚  â”‚  â†’ Aggregate results â†’ Statistical confidence              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                    â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                    â”‚  Result Aggregationâ”‚                         â”‚
â”‚                    â”‚  & Analysis        â”‚                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OUTPUT: Ultra-Rich Report                      â”‚
â”‚  (1~2ì´ˆ)                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ğŸ“Š Final Prediction                                              â”‚
â”‚  ğŸ“ˆ Probability Distribution (5 scenarios)                        â”‚
â”‚  âš½ Minute-by-Minute Timeline (key events)                        â”‚
â”‚  ğŸ‘¤ Player Performance Breakdown (22 players)                     â”‚
â”‚  ğŸ¯ Tactical Insights (depth analysis)                            â”‚
â”‚  ğŸ“‰ Risk Factors & Variables                                      â”‚
â”‚  ğŸ’¡ Betting Recommendations (PRO only)                            â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL EXECUTION TIME: 35~110ì´ˆ (BASIC: 35~65ì´ˆ, PRO: 50~110ì´ˆ)
```

---

## ğŸ¤– Multi-Agent AI System Design

### **Agent 1: Strategic Analyst (ì „ëµ ë¶„ì„ê°€)**

**Role**: ì „ìˆ ì  ë§¤ì¹˜ì—…ê³¼ íŒ€ ì „ëµ ë¶„ì„

**Prompt Structure**:
```python
SYSTEM_PROMPT = """
You are a world-class football tactical analyst with 20+ years of experience.
Your specialty is analyzing team formations, tactical matchups, and identifying
strategic advantages and weaknesses.

<thinking>
Use extended reasoning to deeply analyze:
1. Formation compatibility (4-3-3 vs 4-4-2 analysis)
2. Pressing schemes and counter-pressing vulnerability
3. Width vs compactness tactical trade-offs
4. Set-piece strengths/weaknesses
5. Key individual matchups (e.g., fast winger vs slow fullback)
</thinking>

Provide a comprehensive tactical assessment report.
"""

USER_PROMPT = f"""
Analyze this tactical matchup:

HOME TEAM: {home_team}
Formation: {home_formation}
Playing Style: {home_style}
Key Players: {home_key_players}
Tactical Strengths: {home_strengths}

AWAY TEAM: {away_team}
Formation: {away_formation}
Playing Style: {away_style}
Key Players: {away_key_players}
Tactical Strengths: {away_strengths}

USER ANALYSIS:
{user_evaluation}

SHARP BOOKMAKER ODDS:
{sharp_odds}

Provide deep tactical analysis with confidence scores.
"""
```

**Expected Output**:
```json
{
  "tactical_matchup": {
    "overall_advantage": "HOME",
    "confidence": 0.72,
    "reasoning": "4-3-3 high press will exploit 4-4-2's wide spaces...",
    "key_battles": [
      {
        "area": "Left Wing",
        "home_player": "Salah",
        "away_player": "Robertson",
        "advantage": "HOME",
        "impact": "HIGH"
      }
    ],
    "tactical_adjustments": [
      "Away team may drop deeper to absorb pressure",
      "Home team's fullbacks will push high"
    ]
  }
}
```

---

### **Agent 2: Offensive Specialist (ê³µê²© ì „ë¬¸ê°€)**

**Role**: ê³µê²© íŒ¨í„´ ì˜ˆì¸¡ ë° ë“ì  ê¸°íšŒ ë¶„ì„

**Prompt Structure**:
```python
SYSTEM_PROMPT = """
You are an elite attacking play analyst specializing in expected goals (xG),
shot creation, and offensive patterns.

<thinking>
Analyze step-by-step:
1. Expected shot volume per team
2. Shot quality (xG per shot)
3. Key passing lanes and creative players
4. Counter-attack opportunities
5. Set-piece scoring potential
6. Individual goal-scoring threats
</thinking>

Calculate precise offensive metrics with statistical backing.
"""

USER_PROMPT = f"""
Calculate offensive potential:

HOME TEAM ATTACKING METRICS:
- Player Ratings: {home_attack_ratings}
- Recent Form: {home_form}
- Goals Scored (Last 5): {home_goals_scored}
- xG (Last 5): {home_xg}
- Shot Accuracy: {home_shot_accuracy}

AWAY TEAM ATTACKING METRICS:
- Player Ratings: {away_attack_ratings}
- Recent Form: {away_form}
- Goals Scored (Last 5): {away_goals_scored}
- xG (Last 5): {away_xg}
- Shot Accuracy: {away_shot_accuracy}

DEFENSIVE OPPOSITION:
Home Defense Quality: {home_defense}
Away Defense Quality: {away_defense}

Calculate expected goals and scoring probabilities.
"""
```

**Expected Output**:
```json
{
  "offensive_analysis": {
    "home_xg": 1.85,
    "away_xg": 1.23,
    "home_shot_volume": 14.2,
    "away_shot_volume": 9.8,
    "goal_scoring_moments": [
      {
        "minute_range": "15-30",
        "team": "HOME",
        "probability": 0.28,
        "scenario": "High press forces turnover â†’ quick counter"
      },
      {
        "minute_range": "60-75",
        "team": "AWAY",
        "probability": 0.19,
        "scenario": "Set piece from dangerous area"
      }
    ],
    "top_scorers": [
      {"player": "Salah", "probability": 0.42},
      {"player": "Nunez", "probability": 0.31}
    ]
  }
}
```

---

### **Agent 3: Defensive Specialist (ìˆ˜ë¹„ ì „ë¬¸ê°€)**

**Role**: ìˆ˜ë¹„ ì•ˆì •ì„± ë° ì‹¤ì  ë¦¬ìŠ¤í¬ ë¶„ì„

**Prompt Structure**:
```python
SYSTEM_PROMPT = """
You are a defensive tactics expert specializing in analyzing defensive
stability, pressing resistance, and defensive vulnerabilities.

<thinking>
Deep analysis of:
1. Defensive line organization
2. Pressing resistance under pressure
3. Individual defensive errors risk
4. Aerial dominance
5. Transition defense quality
6. Goalkeeper performance impact
</thinking>

Provide defensive stability index with risk factors.
"""
```

**Expected Output**:
```json
{
  "defensive_analysis": {
    "home_stability_index": 7.8,
    "away_stability_index": 6.4,
    "home_goals_conceded_xg": 1.12,
    "away_goals_conceded_xg": 1.74,
    "defensive_vulnerabilities": [
      {
        "team": "AWAY",
        "weakness": "Slow center-backs vs pace",
        "exploitability": "HIGH",
        "impact_on_xga": 0.32
      }
    ]
  }
}
```

---

### **Agent 4: Player Performance Predictor**

**Role**: 22ëª… ì„ ìˆ˜ ê°œë³„ í¼í¬ë¨¼ìŠ¤ ì˜ˆì¸¡

**Expected Output**:
```json
{
  "player_predictions": [
    {
      "name": "Mohamed Salah",
      "team": "HOME",
      "position": "RW",
      "predicted_rating": 8.2,
      "goal_probability": 0.42,
      "assist_probability": 0.31,
      "key_actions": 8.5,
      "performance_factors": [
        "Excellent recent form (3 goals in last 2)",
        "Strong matchup vs opponent's LB",
        "High expected touches in final third"
      ]
    }
    // ... 21 more players
  ]
}
```

---

## âš™ï¸ Monte Carlo Match Simulation Engine

### **Minute-by-Minute Event Generation**

```python
class MatchSimulationEngine:
    """
    90ë¶„ ê²½ê¸°ë¥¼ ë¶„ë‹¨ìœ„ë¡œ ì‹œë®¬ë ˆì´ì…˜í•˜ëŠ” Monte Carlo ì—”ì§„
    """

    def __init__(self, tactical_report, offensive_report, defensive_report, player_predictions):
        self.tactical = tactical_report
        self.offensive = offensive_report
        self.defensive = defensive_report
        self.players = player_predictions

        # Game state
        self.score = [0, 0]
        self.possession = [50, 50]
        self.momentum = 0  # -100 (away) ~ +100 (home)

    def simulate_minute(self, minute):
        """ë¶„ë‹¨ìœ„ ì‹œë®¬ë ˆì´ì…˜"""

        # 1. Determine possession
        possession_team = self._calculate_possession(minute)

        # 2. Event probability
        event_type = self._determine_event_type(minute, possession_team)

        # 3. Execute event
        event_result = self._execute_event(event_type, possession_team, minute)

        # 4. Update game state
        self._update_state(event_result)

        return {
            'minute': minute,
            'possession': possession_team,
            'event': event_type,
            'result': event_result,
            'score': self.score.copy(),
            'momentum': self.momentum
        }

    def _calculate_possession(self, minute):
        """ì ìœ ìœ¨ ê³„ì‚° (ì „ìˆ , ëª¨ë©˜í…€, ì‹œê°„ëŒ€ ë°˜ì˜)"""

        base_home_possession = self.tactical['home_possession_expected']

        # ëª¨ë©˜í…€ ì˜í–¥
        momentum_modifier = self.momentum * 0.1

        # ì‹œê°„ëŒ€ ì˜í–¥ (leading teamì´ ì ìœ ìœ¨ ë‚®ì¶¤)
        time_modifier = 0
        if minute > 70:
            if self.score[0] > self.score[1]:
                time_modifier = -5  # í™ˆíŒ€ì´ ì´ê¸°ë©´ ì ìœ ìœ¨ ë‚®ì¶¤
            elif self.score[1] > self.score[0]:
                time_modifier = 5

        final_possession = base_home_possession + momentum_modifier + time_modifier

        # í™•ë¥ ì  ê²°ì •
        return 'HOME' if random.random() < (final_possession / 100) else 'AWAY'

    def _determine_event_type(self, minute, possession_team):
        """ì´ë²¤íŠ¸ íƒ€ì… ê²°ì •"""

        # xG ê¸°ë°˜ ìŠˆíŒ… í™•ë¥  ê³„ì‚°
        xg = self.offensive['home_xg'] if possession_team == 'HOME' else self.offensive['away_xg']
        shot_probability = xg / 90  # ë¶„ë‹¹ ìŠˆíŒ… í™•ë¥ 

        rand = random.random()

        if rand < shot_probability:
            return 'SHOT'
        elif rand < shot_probability + 0.05:
            return 'CORNER'
        elif rand < shot_probability + 0.08:
            return 'FREE_KICK'
        elif rand < shot_probability + 0.10:
            return 'YELLOW_CARD'
        else:
            return 'POSSESSION'

    def _execute_event(self, event_type, team, minute):
        """ì´ë²¤íŠ¸ ì‹¤í–‰"""

        if event_type == 'SHOT':
            return self._execute_shot(team, minute)
        elif event_type == 'CORNER':
            return {'type': 'CORNER', 'team': team, 'minute': minute}
        elif event_type == 'FREE_KICK':
            return {'type': 'FREE_KICK', 'team': team, 'minute': minute}
        else:
            return {'type': 'POSSESSION', 'team': team}

    def _execute_shot(self, team, minute):
        """ìŠˆíŒ… ì‹¤í–‰ ë° ê³¨ íŒì •"""

        # ìŠˆíŒ… ì„ ìˆ˜ ì„ íƒ (í™•ë¥  ê¸°ë°˜)
        shooter = self._select_shooter(team)

        # ê³¨ í™•ë¥  ê³„ì‚°
        base_goal_prob = shooter['goal_probability']

        # ìƒí™© modifier
        situation_modifier = 1.0
        if minute > 80:
            situation_modifier *= 1.2  # í›„ë°˜ ë§‰íŒ ì§‘ì¤‘ë ¥ ì €í•˜

        if self.momentum > 50 and team == 'HOME':
            situation_modifier *= 1.15  # í™ˆíŒ€ ëª¨ë©˜í…€ ë³´ë„ˆìŠ¤
        elif self.momentum < -50 and team == 'AWAY':
            situation_modifier *= 1.15

        final_goal_prob = base_goal_prob * situation_modifier

        # ê³¨ íŒì •
        is_goal = random.random() < final_goal_prob

        if is_goal:
            team_idx = 0 if team == 'HOME' else 1
            self.score[team_idx] += 1
            self.momentum += 20 if team == 'HOME' else -20
            self.momentum = max(-100, min(100, self.momentum))

            return {
                'type': 'GOAL',
                'team': team,
                'player': shooter['name'],
                'minute': minute,
                'score': self.score.copy()
            }
        else:
            return {
                'type': 'SHOT_MISSED',
                'team': team,
                'player': shooter['name'],
                'minute': minute
            }

    def run_full_match(self):
        """90ë¶„ ì „ì²´ ì‹œë®¬ë ˆì´ì…˜"""

        timeline = []

        for minute in range(1, 91):
            event = self.simulate_minute(minute)

            # ì£¼ìš” ì´ë²¤íŠ¸ë§Œ íƒ€ì„ë¼ì¸ì— ì¶”ê°€
            if event['event'] in ['SHOT', 'GOAL', 'CORNER', 'FREE_KICK', 'YELLOW_CARD']:
                timeline.append(event)

        return {
            'final_score': self.score,
            'timeline': timeline,
            'final_possession': self.possession,
            'total_shots': len([e for e in timeline if e['event'] in ['SHOT', 'GOAL']]),
            'total_corners': len([e for e in timeline if e['event'] == 'CORNER'])
        }

    def run_monte_carlo(self, n_simulations=1000):
        """Monte Carlo ì‹œë®¬ë ˆì´ì…˜ (1000íšŒ ë°˜ë³µ)"""

        results = []

        for _ in range(n_simulations):
            # ì‹œë®¬ë ˆì´ì…˜ ì´ˆê¸°í™”
            self.__init__(self.tactical, self.offensive, self.defensive, self.players)

            # 90ë¶„ ê²½ê¸° ì‹¤í–‰
            match_result = self.run_full_match()
            results.append(match_result)

        # ê²°ê³¼ ì§‘ê³„
        return self._aggregate_results(results)

    def _aggregate_results(self, results):
        """1000íšŒ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ ì§‘ê³„"""

        home_wins = sum(1 for r in results if r['final_score'][0] > r['final_score'][1])
        draws = sum(1 for r in results if r['final_score'][0] == r['final_score'][1])
        away_wins = sum(1 for r in results if r['final_score'][0] < r['final_score'][1])

        avg_home_goals = sum(r['final_score'][0] for r in results) / len(results)
        avg_away_goals = sum(r['final_score'][1] for r in results) / len(results)

        # ê°€ì¥ ê°€ëŠ¥ì„± ë†’ì€ ìŠ¤ì½”ì–´
        score_counts = {}
        for r in results:
            score = f"{r['final_score'][0]}-{r['final_score'][1]}"
            score_counts[score] = score_counts.get(score, 0) + 1

        most_likely_scores = sorted(score_counts.items(), key=lambda x: x[1], reverse=True)[:5]

        return {
            'probabilities': {
                'home_win': home_wins / len(results),
                'draw': draws / len(results),
                'away_win': away_wins / len(results)
            },
            'expected_score': {
                'home': round(avg_home_goals, 2),
                'away': round(avg_away_goals, 2)
            },
            'most_likely_scores': [
                {'score': score, 'probability': count / len(results)}
                for score, count in most_likely_scores
            ],
            'confidence': self._calculate_confidence(results)
        }
```

---

## ğŸ¯ Prompt Engineering Strategies

### **1. Extended Thinking (Chain-of-Thought)**

```python
EXTENDED_THINKING_PROMPT = """
<thinking>
Let me analyze this match systematically:

Step 1: Formation Analysis
- Home: 4-3-3 (high press, wide play)
- Away: 4-4-2 (compact, counter-attack)
- Tactical advantage: Home team's width will stretch away's narrow midfield

Step 2: Key Player Matchups
- Salah (HOME RW, 92 rating) vs Robertson (AWAY LB, 78 rating)
  â†’ Significant pace advantage, expects 3+ successful dribbles
- Haaland (AWAY ST, 94 rating) vs Van Dijk (HOME CB, 90 rating)
  â†’ Physical battle, slight advantage to defender in home conditions

Step 3: Momentum Factors
- Home team: 3 wins in last 5 (strong form)
- Away team: 2 wins, 2 draws, 1 loss (inconsistent)
- Home advantage: +0.3 goals expected

Step 4: Risk Assessment
- Home team pressing leaves space for counter-attacks
- Away team's compact defense may frustrate home attackers
- Set-pieces could be decisive

Step 5: Probability Calculation
Based on above factors:
- Home win: 45-50%
- Draw: 25-30%
- Away win: 20-25%

Expected score: 2.1 - 1.4 (Home)
Most likely scores: 2-1 (28%), 1-1 (22%), 2-0 (18%)
</thinking>

Based on my detailed analysis, here is my prediction...
"""
```

### **2. Multi-Step Reasoning**

```python
MULTI_STEP_PROMPT = """
I will analyze this match in multiple stages:

STAGE 1: Data Validation
- Verify all player ratings are current
- Confirm injury/suspension status
- Validate recent form statistics

STAGE 2: Tactical Framework
- Identify primary tactical approach for each team
- Map key strategic matchups
- Assess tactical flexibility

STAGE 3: Predictive Modeling
- Calculate expected goals (xG)
- Estimate possession distribution
- Project shot volume and quality

STAGE 4: Scenario Analysis
- Best case scenario for each team
- Most likely scenario
- Worst case scenario

STAGE 5: Final Synthesis
- Integrate all factors with weighted importance
- Generate probability distribution
- Provide confidence intervals

Proceed with Stage 1...
"""
```

### **3. Self-Critique & Refinement**

```python
SELF_CRITIQUE_PROMPT = """
Initial Prediction: Home 2-1 Away (45% probability)

<self_critique>
Let me challenge my own assumptions:

Potential Bias 1: Am I overweighting recent form?
- Home team's 3 wins were against weaker opponents (15th, 18th, 20th place)
- Away team's draw was against current league leader
â†’ Adjustment: Reduce home advantage from 0.3 to 0.2 goals

Potential Bias 2: Am I underestimating away team's counter-attack threat?
- Away team has scored 60% of goals on counter-attacks this season
- Home team has conceded 8 counter-attack goals (2nd worst in league)
â†’ Adjustment: Increase away xG from 1.2 to 1.4

Potential Bias 3: Weather/pitch conditions not considered
- Heavy rain forecasted (affects passing accuracy)
- Home team relies on short passing (70% pass completion needed)
â†’ Adjustment: Increase variance in outcome

Refined Prediction: Home 2-1 Away (38% probability)
Alternative Scenarios:
- 1-1 Draw (29%)
- 2-2 Draw (12%)
- 1-2 Away Win (11%)
</self_critique>
"""
```

---

## â±ï¸ Execution Timeline

### **Deep Simulation Mode: 50~110ì´ˆ**

```
ğŸ“Š Phase 1: Data Collection (2ì´ˆ)
â”œâ”€ User evaluation fetch (0.1ì´ˆ)
â”œâ”€ Sharp Vision API (0.5ì´ˆ)
â”œâ”€ Football-Data API (1.0ì´ˆ)
â””â”€ Data normalization (0.4ì´ˆ)

ğŸ§  Phase 2: Multi-Agent Analysis (20~50ì´ˆ)
â”œâ”€ Agent 1: Tactical Analysis (5~12ì´ˆ)
â”‚   â””â”€ Extended thinking enabled
â”œâ”€ Agent 2: Offensive Analysis (5~12ì´ˆ)
â”‚   â””â”€ xG calculation with CoT
â”œâ”€ Agent 3: Defensive Analysis (5~12ì´ˆ)
â”‚   â””â”€ Vulnerability assessment
â”œâ”€ Agent 4: Player Predictions (5~14ì´ˆ)
â”‚   â””â”€ 22-player individual analysis
â””â”€ Agent Synthesis (3~5ì´ˆ)

âš½ Phase 3: Monte Carlo Simulation (20~50ì´ˆ)
â”œâ”€ Initialize simulation engine (0.5ì´ˆ)
â”œâ”€ Run 1,000 matches (parallel) (15~45ì´ˆ)
â”‚   â”œâ”€ Batch 1-10: 100 simulations each
â”‚   â”œâ”€ Each simulation: 90 minutes
â”‚   â””â”€ Event generation + goal calculation
â””â”€ Result aggregation (4~8ì´ˆ)

ğŸ“ˆ Phase 4: Report Generation (3~8ì´ˆ)
â”œâ”€ Statistical analysis (1ì´ˆ)
â”œâ”€ Timeline formatting (1ì´ˆ)
â”œâ”€ Player breakdown (1~2ì´ˆ)
â”œâ”€ Visualization data prep (1~2ì´ˆ)
â””â”€ Final JSON assembly (1~2ì´ˆ)

TOTAL: 50~110ì´ˆ (í‰ê· : 75ì´ˆ)
```

---

## ğŸ’° Cost Analysis

### **Per Simulation Cost**

```python
# Token Usage Estimation
BASIC_TIER:
  Data Prep: 2,000 tokens (input)
  Agent 1: 4,000 input + 1,500 output
  Agent 2: 3,500 input + 1,200 output
  Agent 3: 3,500 input + 1,200 output
  Agent 4: 5,000 input + 2,000 output (22 players)
  Synthesis: 2,000 input + 1,000 output
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total: 20,000 input + 6,900 output = 26,900 tokens

  Cost: (20K / 1M * $3) + (6.9K / 1M * $15)
      = $0.06 + $0.10 = $0.16 per simulation

PRO_TIER:
  (ë” ê¸´ ì»¨í…ìŠ¤íŠ¸, extended thinking)
  Total: 35,000 input + 12,000 output = 47,000 tokens

  Cost: (35K / 1M * $3) + (12K / 1M * $15)
      = $0.105 + $0.18 = $0.285 per simulation
```

### **Monthly Cost Projection**

```
BASIC User (avg 50 simulations/month):
  50 Ã— $0.16 = $8.00/month

PRO User (avg 200 simulations/month):
  200 Ã— $0.285 = $57.00/month

PRO êµ¬ë…ë£Œ: $19.99/month
PRO Margin: -$37.01 (LOSS!)

âš ï¸ CRITICAL: ë¹„ìš© ì´ˆê³¼ ë¬¸ì œ
```

---

## ğŸšï¸ Tiered Simulation Modes

### **ë¹„ìš© ë¬¸ì œ í•´ê²° ì „ëµ**

#### **Mode 1: Quick Simulation (í˜„ì¬ ë°©ì‹ ìœ ì§€)**
- **ì†ë„**: 1~2ì´ˆ
- **ë°©ì‹**: í´ë¼ì´ì–¸íŠ¸ ìˆ˜í•™ ê³µì‹
- **ë¹„ìš©**: $0
- **ì •í™•ë„**: 70~75%
- **ì œê³µ**: BASIC & PRO ëª¨ë‘ ë¬´ì œí•œ

#### **Mode 2: Standard AI Simulation (BASIC)**
- **ì†ë„**: 8~15ì´ˆ
- **ë°©ì‹**: Single-agent Claude + ê¸°ë³¸ ë¶„ì„
- **ë¹„ìš©**: $0.08/ì‹œë®¬ë ˆì´ì…˜
- **ì •í™•ë„**: 80~85%
- **ì œê³µ**: BASIC ì›” 10íšŒ, PRO ë¬´ì œí•œ

#### **Mode 3: Deep AI Simulation (PRO ì „ìš©)**
- **ì†ë„**: 50~110ì´ˆ
- **ë°©ì‹**: Multi-agent + Monte Carlo
- **ë¹„ìš©**: $0.285/ì‹œë®¬ë ˆì´ì…˜
- **ì •í™•ë„**: 90~95%
- **ì œê³µ**: PRO ì›” 50íšŒ (ì´í›„ $1/ì¶”ê°€)

---

## ğŸš€ Implementation Priority

### **Phase 1: Standard AI Simulation (2ì£¼)**
- Single-agent Claude ì—°ë™
- ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§
- ê²°ê³¼ ìºì‹± ì‹œìŠ¤í…œ
- ë¹„ë™ê¸° ì²˜ë¦¬ (Celery)

### **Phase 2: Multi-Agent System (3ì£¼)**
- 4-agent ì•„í‚¤í…ì²˜ êµ¬í˜„
- Agent communication protocol
- Extended thinking í”„ë¡¬í”„íŠ¸
- Self-critique ë¡œì§

### **Phase 3: Monte Carlo Engine (3ì£¼)**
- ë¶„ë‹¨ìœ„ ì‹œë®¬ë ˆì´ì…˜ ì—”ì§„
- ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™”
- ê²°ê³¼ ì§‘ê³„ ì•Œê³ ë¦¬ì¦˜
- íƒ€ì„ë¼ì¸ ìƒì„±

### **Phase 4: UI/UX Enhancement (2ì£¼)**
- ì‹¤ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜ ì§„í–‰ í‘œì‹œ
- ë¶„ë‹¨ìœ„ íƒ€ì„ë¼ì¸ ì• ë‹ˆë©”ì´ì…˜
- ì„ ìˆ˜ë³„ í¼í¬ë¨¼ìŠ¤ ì°¨íŠ¸
- ì „ìˆ  ë¹„ì£¼ì–¼ë¼ì´ì œì´ì…˜

**Total Timeline: 10ì£¼ (~2.5ê°œì›”)**

---

## ğŸ“Š Success Metrics

### **Accuracy Targets**
- Quick Mode: 70~75% (baseline)
- Standard AI: 80~85%
- Deep AI: 90~95%

### **Performance Targets**
- Quick Mode: <2ì´ˆ
- Standard AI: <15ì´ˆ
- Deep AI: <120ì´ˆ

### **User Satisfaction**
- "Feels realistic": >85%
- "Better than competitors": >80%
- "Worth the wait": >75% (Deep AI)

---

## ğŸ¯ Conclusion

ì´ Deep AI Simulation ì•„í‚¤í…ì²˜ëŠ” **ì‹¤ì œ ê²½ê¸°ë¥¼ ê°€ìƒìœ¼ë¡œ ì¬í˜„**í•˜ëŠ” ìˆ˜ì¤€ì˜ ì •êµí•œ ì‹œë®¬ë ˆì´ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.

**í•µì‹¬ ì¥ì **:
âœ… Multi-agent í˜‘ì—…ìœ¼ë¡œ ë‹¤ê°ë„ ë¶„ì„
âœ… Extended thinkingìœ¼ë¡œ ê¹Šì´ ìˆëŠ” ì¶”ë¡ 
âœ… Monte Carloë¡œ í†µê³„ì  ì‹ ë¢°ë„ í™•ë³´
âœ… ë¶„ë‹¨ìœ„ íƒ€ì„ë¼ì¸ìœ¼ë¡œ ëª°ì…ê° ê·¹ëŒ€í™”

**ë„ì „ ê³¼ì œ**:
âš ï¸ ì‹¤í–‰ ì‹œê°„ (50~110ì´ˆ) - ì‚¬ìš©ì ëŒ€ê¸° ì‹œê°„
âš ï¸ ë¹„ìš© ($0.285/ì‹œë®¬ë ˆì´ì…˜) - PRO í‹°ì–´ ìˆ˜ìµì„±
âš ï¸ ë³µì¡ë„ - êµ¬í˜„ ë° ìœ ì§€ë³´ìˆ˜ ë‚œì´ë„

**ê¶Œì¥ì‚¬í•­**:
ğŸ¯ Phase 1 (Standard AI)ë¶€í„° ì‹œì‘í•˜ì—¬ ì‚¬ìš©ì ë°˜ì‘ ì¸¡ì •
ğŸ¯ Deep AIëŠ” PRO+ í‹°ì–´ë¡œ ë³„ë„ ì œê³µ ($29.99/ì›”)
ğŸ¯ Quick ModeëŠ” ë¬´ë£Œ ìœ ì§€í•˜ì—¬ ì ‘ê·¼ì„± í™•ë³´

---

**Document Status**: âœ… Architecture Design Complete
**Next Step**: Technical Specification & Prototype Development
**Owner**: Development Team
**Last Updated**: 2025-10-09
